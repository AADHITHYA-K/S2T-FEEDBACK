<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S2T 2026 | Feedback Terminal</title>
<link rel="icon" href="assets/s2t.png" type="image/png">

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --electric-yellow: #ffd60a;
  --neon-green: #32f5a0;
  --deep-green: #00cc88;
  --science-blue: #3b82f6;
  --dark-bg: #020617;
  --card-bg: rgba(15, 23, 42, 0.85);
  --glass: rgba(15, 23, 42, 0.8);
  --border-glow: rgba(50, 245, 160, 0.4);
  --text-light: #e5f9f0;
  --muted: #9ca3af;
  --yellow-glow: rgba(255, 214, 10, 0.35);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: radial-gradient(circle at top, #020617 0%, #020617 40%, #000 100%);
  color: #f9fafb;
  font-family: 'Roboto', sans-serif;
  min-height: 100vh;
  margin: 0;
  overflow-x: hidden;
}

/* Subtle grid + glow */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(148, 163, 184, 0.06) 1px, transparent 1px),
    linear-gradient(90deg, rgba(148, 163, 184, 0.06) 1px, transparent 1px);
  background-size: 90px 90px;
  pointer-events: none;
  z-index: -2;
  opacity: 0.4;
}

body::after {
  content: '';
  position: fixed;
  top: -40%;
  right: -10%;
  width: 520px;
  height: 180%;
  background: radial-gradient(circle at 30% 20%, rgba(56, 189, 248, 0.4), transparent 60%),
              radial-gradient(circle at 70% 80%, rgba(52, 211, 153, 0.32), transparent 55%);
  filter: blur(10px);
  pointer-events: none;
  z-index: -3;
}

/* Header */

header {
  padding: 18px 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(8, 47, 73, 0.96));
  border-bottom: 1px solid rgba(148, 163, 184, 0.35);
  box-shadow: 0 12px 40px rgba(15, 23, 42, 0.9);
  position: sticky;
  top: 0;
  z-index: 10;
}

.mission-tag {
  background: linear-gradient(120deg, var(--electric-yellow), var(--neon-green));
  font-family: 'Oswald', sans-serif;
  font-size: 22px;
  font-weight: 900;
  padding: 8px 22px;
  color: #020617;
  text-transform: uppercase;
  letter-spacing: 3px;
  border-radius: 999px;
  box-shadow: 0 10px 40px var(--yellow-glow);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.mission-tag::before {
  content: '‚óè';
  font-size: 12px;
}

#status {
  color: var(--neon-green);
  font-family: 'Oswald', sans-serif;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 2px;
  text-shadow: 0 0 8px rgba(34, 197, 94, 0.8);
}

/* Layout */

main {
  display: grid;
  grid-template-columns: minmax(0, 430px) minmax(0, 1fr);
  gap: 32px;
  padding: 32px;
  max-width: 1440px;
  margin: 0 auto;
}

/* Panels */

.panel {
  background: var(--glass);
  backdrop-filter: blur(22px);
  -webkit-backdrop-filter: blur(22px);
  border-radius: 24px;
  border: 1px solid rgba(148, 163, 184, 0.4);
  padding: 26px 24px 28px;
  position: relative;
  overflow: hidden;
  box-shadow:
    0 18px 60px rgba(15, 23, 42, 0.95),
    0 0 0 1px rgba(15, 23, 42, 0.9);
}

.panel::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 0% 0%, rgba(96, 165, 250, 0.18), transparent 55%);
  opacity: 0.9;
  pointer-events: none;
}

.panel::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(148, 163, 184, 0.15), transparent 40%);
  mix-blend-mode: soft-light;
  pointer-events: none;
}

/* Headings */

h2 {
  position: relative;
  font-family: 'Oswald', sans-serif;
  color: var(--text-light);
  letter-spacing: 2px;
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 18px;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 10px;
}

h2::before {
  content: '';
  width: 4px;
  height: 18px;
  border-radius: 999px;
  background: linear-gradient(to bottom, var(--neon-green), var(--electric-yellow));
}

/* Forms */

label {
  font-size: 11px;
  color: var(--muted);
  margin-top: 14px;
  display: block;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
}

input,
select,
textarea {
  width: 100%;
  background: rgba(15, 23, 42, 0.85);
  border: 1px solid rgba(107, 114, 128, 0.9);
  padding: 11px 12px;
  color: #f9fafb;
  font-family: 'Roboto', sans-serif;
  font-size: 14px;
  border-radius: 10px;
  margin-top: 6px;
  transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, transform 0.08s ease;
}

input::placeholder,
textarea::placeholder {
  color: rgba(156, 163, 175, 0.9);
}

input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--neon-green);
  background: rgba(15, 23, 42, 0.98);
  box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5), 0 0 20px rgba(34, 197, 94, 0.25);
  transform: translateY(-1px);
}

textarea {
  min-height: 90px;
  resize: vertical;
}

/* Custom selects */

#grade,
#event {
  color: #f9fafb;
  background-color: rgba(15, 23, 42, 0.9);
  position: relative;
  font-family: 'Roboto', sans-serif;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding-right: 34px;
}

#grade::-ms-expand,
#event::-ms-expand {
  display: none;
}

#grade {
  background-image: linear-gradient(to right, var(--neon-green), var(--electric-yellow));
  background-origin: border-box;
}

#grade,
#event {
  position: relative;
}

#grade::after,
#event::after {
  content: '‚ñæ';
}

/* Photo grid */

.photo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(108px, 1fr));
  gap: 14px;
  margin-top: 14px;
}

.target-hex {
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  cursor: pointer;
  border: 1px solid rgba(148, 163, 184, 0.5);
  background: radial-gradient(circle at 20% 0%, rgba(56, 189, 248, 0.15), transparent 55%);
  transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
}

.target-hex img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  aspect-ratio: 4 / 5;
  filter: saturate(1.05);
  opacity: 0.7;
  transition: opacity 0.18s ease, transform 0.18s ease;
}

.target-hex::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(56, 189, 248, 0.25), transparent 50%);
  mix-blend-mode: soft-light;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.target-hex:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.95);
  border-color: rgba(59, 130, 246, 0.8);
}

.target-hex:hover img {
  opacity: 0.95;
  transform: scale(1.02);
}

.target-hex.selected {
  transform: translateY(-2px) scale(1.01);
  border-color: var(--electric-yellow);
  box-shadow: 0 0 0 1px rgba(234, 179, 8, 0.6), 0 16px 40px rgba(15, 23, 42, 0.98);
}

.target-hex.selected::before {
  opacity: 1;
}

.target-hex.selected img {
  opacity: 1;
}

/* Ratings */

.rate-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  margin-top: 8px;
  background: rgba(15, 23, 42, 0.9);
  border-radius: 12px;
  border: 1px solid rgba(55, 65, 81, 0.9);
  transition: border-color 0.16s ease, background 0.16s ease;
}

.rate-row:hover {
  border-color: rgba(96, 165, 250, 0.9);
}

.rate-row span:first-child {
  font-weight: 500;
  color: var(--text-light);
  font-size: 13px;
}

.emojis {
  display: flex;
  gap: 8px;
}

.emojis span {
  cursor: pointer;
  opacity: 0.35;
  font-size: 22px;
  transition: opacity 0.15s ease, transform 0.12s ease, filter 0.12s ease;
}

.emojis span:hover {
  opacity: 0.7;
  transform: translateY(-1px) scale(1.08);
}

.emojis span.active {
  opacity: 1;
  transform: translateY(-1px) scale(1.18);
  filter: drop-shadow(0 0 10px rgba(250, 204, 21, 0.8));
}

/* Buttons */

.btn {
  width: 100%;
  padding: 14px 18px;
  background: linear-gradient(135deg, var(--electric-yellow), var(--neon-green));
  border: none;
  color: #020617;
  font-family: 'Oswald', sans-serif;
  font-size: 16px;
  font-weight: 800;
  margin-top: 18px;
  cursor: pointer;
  border-radius: 999px;
  text-transform: uppercase;
  letter-spacing: 0.22em;
  transition: transform 0.14s ease, box-shadow 0.16s ease, filter 0.12s ease;
  box-shadow: 0 12px 30px var(--yellow-glow);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 16px 40px rgba(234, 179, 8, 0.45);
  filter: brightness(1.03);
}

.btn:active {
  transform: translateY(0);
  box-shadow: 0 8px 22px rgba(15, 23, 42, 0.9);
}

/* Canvas */

canvas {
  border-radius: 18px;
  max-width: 100%;
  box-shadow: 0 20px 50px rgba(15, 23, 42, 0.95);
  background: radial-gradient(circle at top, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.98));
  border: 1px solid rgba(55, 65, 81, 0.9);
}

/* Thank You Screen */

#thankYouScreen {
  display: none;
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at top, #020617 0%, #000 60%);
  z-index: 1000;
  text-align: center;
  padding: 36px 16px 24px;
  overflow-y: auto;
}

#thankYouScreen h1 {
  color: var(--electric-yellow);
  font-family: 'Oswald', sans-serif;
  font-size: 34px;
  font-weight: 900;
  margin-bottom: 10px;
  text-shadow: 0 0 24px var(--yellow-glow);
}

#thankYouScreen p {
  color: var(--neon-green);
  font-size: 17px;
  margin-bottom: 24px;
  font-weight: 500;
}

.button-group {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
  max-width: 540px;
  margin: 0 auto 18px;
}

.button-group .btn {
  flex: 1;
  min-width: 180px;
}

/* Responsive */

@media (max-width: 1200px) {
  main {
    grid-template-columns: minmax(0, 1fr);
    padding: 20px;
  }
}

@media (max-width: 768px) {
  header {
    flex-direction: column;
    gap: 10px;
    padding: 14px 20px;
  }

  .mission-tag {
    font-size: 18px;
    padding: 6px 16px;
  }

  h2 {
    font-size: 14px;
  }

  .photo-grid {
    grid-template-columns: repeat(auto-fill, minmax(92px, 1fr));
    gap: 10px;
  }

  #thankYouScreen h1 {
    font-size: 26px;
  }

  .button-group {
    flex-direction: column;
  }

  .button-group .btn {
    width: 100%;
  }
}
</style>
</head>

<body>

<header>
    <div class="mission-tag"> S2T FEEDBACK TERMINAL</div>
    <div id="status">>> SYSTEM_READY</div>
</header>

<main>

<section class="panel">
    <h2>üéØ Personnel Input</h2>

    <form id="missionForm">
        <label>Mission Category</label>
        <select id="event" required onchange="fetchDrive(this.value);drawPoster()">
            <option value="">SELECT EVENT...</option>
            <option>Junior Scientist</option>
            <option>Senior Scientist</option>
            <option>Photography</option>
            <option>English Essay Writing</option>
            <option>Tamil Essay Writing</option>
            <option>Podcast</option>
            <option>Scouts Activities</option>
            <option>SDG Treasure Hunt</option>
            <option>Rise Above</option>
        </select>

        <label>NAME</label>
        <input id="name" required oninput="drawPoster()" placeholder="Enter your name">

        <label>SCHOOL NAME</label>
        <input id="school" required oninput="drawPoster()" placeholder="Enter your school">

        <label>CLASS</label>
        <select id="grade" required onchange="drawPoster()">
            <option value="">SELECT...</option>
            <option>8</option>
            <option>9</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
        </select>

        <h2 style="margin-top:30px">SELECT YOUR PHOTO FROM THE LIST</h2>
        <div id="photoGrid" class="photo-grid"></div>

        <h2 style="margin-top:30px">YOUR RATINS</h2>
        <div id="ratingsBody"></div>

        <label>BEST PART OF THE EVENT</label>
        <textarea id="best" placeholder="What did you enjoy most?"></textarea>

        <label>ANY IMPROVEMENTS</label>
        <textarea id="improve" placeholder="How can we make it better?"></textarea>

        <button class="btn" type="submit">üöÄ Generate Poster</button>
    </form>
</section>

<section class="panel">
    <h2> Poster Preview</h2>
    <canvas id="poster" width="1080" height="1350"></canvas>
</section>

</main>

<!-- Success Screen -->
<div id="thankYouScreen">
    <h1>üéâ MISSION COMPLETE</h1>
    <p>Here is your generated poster</p>
    
    <div style="max-width:500px; margin:0 auto 30px;">
        <canvas id="thankYouPreview" width="500" height="625"></canvas>
    </div>
    
    <div class="button-group">
        <button onclick="editForm()" class="btn" style="background:#444;">‚úèÔ∏è Re-Edit</button>
        <button onclick="shareMission()" class="btn" style="background:#25D366;">üì° Share Mission</button>
    </div>
    
    <div class="button-group">
        <a id="downloadLink" class="btn" style="background:var(--electric-yellow); color:#001a0f; text-decoration:none;" download>‚¨áÔ∏è Download Poster</a>
        <a href="index.html" class="btn" style="background:var(--science-blue);">üè† Return Home</a>
    </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyQaLT_m1EvP8lXbXpNDK_wiyg1YOMoWL6-jdZkeqyaXplwHkO043W3upG4PlmN7hk4eQ/exec";

const canvas = document.getElementById("poster");
const ctx = canvas.getContext("2d");
const statusEl = document.getElementById("status");

let template = new Image();
let templateLoaded = false;
let selectedPhoto = null;
let previewPhoto = null;

const POSTER_W = 1080;
const POSTER_H = 1350;
const PHOTO_BOX = { x: 87.5, y: 513, w: 912.1, h: 578.8 };
const SCHOOL_BOX = { x: 150, y: 392.9, w: 801.8, h: 98.1 };

template.onload = () => {
    templateLoaded = true;
    drawPoster();
};
template.src = "poster-template.png";

function editForm() {
    document.getElementById("thankYouScreen").style.display = "none";
    statusEl.innerText = ">> SYSTEM_READY (RE-EDIT_MODE)";
}

async function shareMission() {
    const canvas = document.getElementById("poster");
    canvas.toBlob(async (blob) => {
        const file = new File([blob], "S2T_Mission_Poster.jpg", { type: "image/jpeg" });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
                await navigator.share({
                    files: [file],
                    title: 'S2T 2026 | Mission Accomplished',
                    text: 'Check out my Mission Poster from S2T 2026!',
                });
            } catch (err) {
                console.log("Share failed:", err);
            }
        } else {
            alert("Sharing not supported on this browser. Please use the Download button!");
        }
    }, "image/jpeg", 0.9);
}

function drawPoster() {
    const photoToDraw = selectedPhoto || previewPhoto;
    if (!templateLoaded) return;

    ctx.clearRect(0, 0, POSTER_W, POSTER_H);
    ctx.drawImage(template, 0, 0, POSTER_W, POSTER_H);

    if (photoToDraw && photoToDraw.naturalWidth) {
        const { x, y, w, h } = PHOTO_BOX;
        ctx.save();
        
        ctx.beginPath();
        const r = 24; 
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + w - r, y);
        ctx.quadraticCurveTo(x + w, y, x + w, y + r);
        ctx.lineTo(x + w, y + h - r);
        ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
        ctx.lineTo(x + r, y + h);
        ctx.quadraticCurveTo(x, y + h, x, y + h - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
        ctx.closePath();
        ctx.clip();

        const scale = Math.max(w / photoToDraw.naturalWidth, h / photoToDraw.naturalHeight);
        const dw = photoToDraw.naturalWidth * scale;
        const dh = photoToDraw.naturalHeight * scale;

        ctx.drawImage(photoToDraw, x + (w - dw) / 2, y + (h - dh) / 2, dw, dh);
        ctx.restore();
    } else if (statusEl && statusEl.innerText.includes("OPTIMIZING")) {
        ctx.fillStyle = "rgba(0, 20, 40, 0.8)";
        ctx.fillRect(PHOTO_BOX.x, PHOTO_BOX.y, PHOTO_BOX.w, PHOTO_BOX.h);
        
        const scanY = PHOTO_BOX.y + (Date.now() % 2000 / 2000) * PHOTO_BOX.h;
        ctx.strokeStyle = "#06ffa5";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(PHOTO_BOX.x, scanY);
        ctx.lineTo(PHOTO_BOX.x + PHOTO_BOX.w, scanY);
        ctx.stroke();

        ctx.fillStyle = "#06ffa5";
        ctx.font = "24px 'Oswald'";
        ctx.textAlign = "center";
        ctx.fillText("DECRYPTING PIXELS...", PHOTO_BOX.x + PHOTO_BOX.w/2, PHOTO_BOX.y + PHOTO_BOX.h/2);
        
        requestAnimationFrame(drawPoster);
    }

    const schoolVal = document.getElementById("school") ? document.getElementById("school").value : "";
    drawAutoFitText(
        (schoolVal || "SCHOOL NAME").toUpperCase(),
        SCHOOL_BOX.x + SCHOOL_BOX.w / 2,
        SCHOOL_BOX.y + SCHOOL_BOX.h / 2 + 12, 
        SCHOOL_BOX.w, 44, 22, "Oswald", "#111827"
    );

    const nameVal = document.getElementById("name") ? document.getElementById("name").value : "";
    drawAutoFitText(
        (nameVal || "AGENT NAME").toUpperCase(),
        540, 1150, 800, 48, 24, "Oswald", "#111827"
    );
}

function drawAutoFitText(text, x, y, maxWidth, maxFontSize, minFontSize, fontFamily, color) {
    let fontSize = maxFontSize;
    do {
        ctx.font = `bold ${fontSize}px ${fontFamily}`;
        if (ctx.measureText(text).width <= maxWidth) break;
        fontSize--;
    } while (fontSize >= minFontSize);
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text, x, y);
}

async function fetchDrive(mission) {
    const photoGrid = document.getElementById("photoGrid");
    photoGrid.innerHTML = "<div style='color:var(--neon-green);padding:20px;text-align:center;font-family:Oswald;'>‚ö° SCANNING DATABASE...</div>";

    try {
        const r = await fetch(`${API_URL}?mission=${encodeURIComponent(mission)}`);
        const data = await r.json();
        photoGrid.innerHTML = "";

        data.forEach(img => {
            const box = document.createElement("div");
            box.className = "target-hex";
            const thumbImg = document.createElement("img");
            thumbImg.src = img.thumbnail; 
            box.appendChild(thumbImg);
            
            box.onclick = async () => {
                document.querySelectorAll(".target-hex").forEach(x => x.classList.remove("selected"));
                box.classList.add("selected");
                
                const imgObject = new Image();
                imgObject.crossOrigin = "anonymous"; 
                statusEl.innerText = ">> OPTIMIZING_RESOLUTION...";

                try {
                    const response = await fetch(`${API_URL}?base64id=${img.id}`);
                    let base64Data = await response.text();
                    base64Data = base64Data.trim().replace(/^"|"$/g, '');

                    imgObject.onload = () => {
                        selectedPhoto = imgObject; 
                        previewPhoto = null; 
                        drawPoster();              
                        statusEl.innerText = ">> TARGET_READY ‚úì";
                    };
                    
                    imgObject.src = base64Data;
                } catch (err) {
                    statusEl.innerText = ">> SECURITY_ERR";
                }
            };
            
            photoGrid.appendChild(box);
        });
    } catch (err) {
        photoGrid.innerHTML = "<div style='color:var(--electric-yellow);padding:20px;text-align:center;'>‚ö†Ô∏è CONNECTION OFFLINE</div>";
    }
}

["Experience","Venue","Timing","Staff","Food","Learning","Overall"].forEach(m => {
    document.getElementById("ratingsBody").innerHTML += `
        <div class="rate-row">
            <span>${m}</span>
            <div class="emojis">
                <span onclick="rate(this)">üò°</span>
                <span onclick="rate(this)">üòê</span>
                <span onclick="rate(this)">üòä</span>
                <span onclick="rate(this)">ü§©</span>
            </div>
        </div>`;
});

function rate(el) {
    el.parentElement.querySelectorAll("span").forEach(s => s.classList.remove("active"));
    el.classList.add("active");
}

missionForm.onsubmit = async (e) => {
    e.preventDefault();

    if (!selectedPhoto) {
        alert("‚ö†Ô∏è Please wait for HIGH-RES optimization to finish (TARGET_READY) before generating!");
        return;
    }

    previewPhoto = null;
    drawPoster();

    const posterData = canvas.toDataURL("image/jpeg", 0.8);
    statusEl.innerText = ">> UPLOADING TO MISSION CONTROL...";

    const ratings = Array.from(document.querySelectorAll('.rate-row'))
        .map(row => `${row.querySelector('span').innerText}: ${row.querySelector('.active').innerText}`)
        .join(' | ');

    const payload = {
        name: document.getElementById("name").value,
        school: document.getElementById("school").value,
        grade: document.getElementById("grade").value,
        event: document.getElementById("event").value,
        best: document.getElementById("best").value,
        improve: document.getElementById("improve").value,
        ratings: ratings,
        poster: posterData
    };

    document.getElementById("thankYouScreen").style.display = "block";
    const tyCtx = document.getElementById("thankYouPreview").getContext("2d");
    tyCtx.drawImage(canvas, 0, 0, 500, 625);
    document.getElementById("downloadLink").href = posterData;

    fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(payload)
    }).then(() => {
        statusEl.innerText = ">> MISSION_ACCOMPLISHED ‚úì";
    }).catch((err) => {
        console.error("Upload error:", err);
        statusEl.innerText = ">> UPLOAD_FAILED - RETRY";
    });
};
</script>

</body>
</html>
